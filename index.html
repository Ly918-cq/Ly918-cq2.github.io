<!-- 在预览区新增按钮 -->
<div class="flex flex-col sm:flex-row justify-center gap-3 mb-4">
  <!-- 新增：保存数据按钮 -->
  <button id="saveDataBtn" class="bg-blue-600 text-white font-medium px-6 py-3 rounded-lg hover:bg-blue-700 w-full sm:w-auto">
    <i class="fa-solid fa-save mr-1"></i>保存数据
  </button>
  <!-- 新增：查看统计按钮 -->
  <button id="viewStatBtn" class="bg-purple-600 text-white font-medium px-6 py-3 rounded-lg hover:bg-purple-700 w-full sm:w-auto">
    <i class="fa-solid fa-chart-pie mr-1"></i>数据统计
  </button>
</div>

<!-- 统计弹窗（默认隐藏） -->
<div id="statModal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden z-50">
  <div class="bg-white rounded-lg p-6 w-full max-w-2xl max-h-[80vh] overflow-auto">
    <h3 class="text-lg font-bold mb-4">数据统计</h3>
    <div class="mb-4">
      <p>总合格证数量：<span id="totalCerts">-</span></p>
    </div>
    <div class="mb-4">
      <h4 class="font-medium mb-2">按产品类型统计</h4>
      <div id="productStat"></div>
    </div>
    <button id="closeModalBtn" class="bg-gray-600 text-white px-4 py-2 rounded-lg">关闭</button>
  </div>
</div>

<!-- 新增JS逻辑 -->
<script>
  // 保存数据
  document.getElementById('saveDataBtn').addEventListener('click', async () => {
    try {
      const res = await fetch('https://nanke-farm-backend.vercel.app/api/save-cert', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(currentCertData)
      });
      const data = await res.json();
      alert(data.message);
    } catch (err) {
      alert('保存失败：' + err.message);
    }
  });

  // 查看统计
  document.getElementById('viewStatBtn').addEventListener('click', async () => {
    try {
      const res = await fetch('https://nanke-farm-backend.vercel.app/api/stat');
      const data = await res.json();
      if (data.success) {
        // 填充统计数据
        document.getElementById('totalCerts').textContent = data.data.total;
        // 填充产品统计
        let productHtml = '';
        data.data.productStat.forEach(item => {
          productHtml += `<p>${item._id}：${item.count} 张</p>`;
        });
        document.getElementById('productStat').innerHTML = productHtml;
        // 显示弹窗
        document.getElementById('statModal').classList.remove('hidden');
      }
    } catch (err) {
      alert('获取统计数据失败：' + err.message);
    }
  });

  // 关闭弹窗
  document.getElementById('closeModalBtn').addEventListener('click', () => {
    document.getElementById('statModal').classList.add('hidden');
  });
</script>
